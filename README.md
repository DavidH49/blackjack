Debugging this was hell.

# TODO
* Make the code more concise, perhaps by adding a `Dealer` class
