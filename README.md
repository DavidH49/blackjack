Debugging this was hell.

# TODO
* Make the code more readable, perhaps by adding a `Dealer` class
